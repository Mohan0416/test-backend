// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  BRAND
  ADMIN
}

model User {
  id           String   @id @default(uuid())
  name         String
  username     String   @unique
  email        String   @unique
  password     String
  role         Role     @default(USER)
  sessionToken String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  follows      Follow[]
  likes        Like[]
  comments     Comment[]
  savedBy SavedPost[]
  collections Collection[]
  brandReviews BrandReview[]
  leadSubmissions LeadSubmission[]


  conversationParticipants ConversationParticipant[]

}

model Brand {
  id           String   @id @default(uuid())
  name         String
  username     String   @unique
  email        String   @unique
  password     String
  role         Role     @default(BRAND)
  sessionToken String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  posts        Post[]
  followers    Follow[]
  gallery      BrandGallery[]
  quicksite    Quicksite?
  reviews BrandReview[]
  testimonials Testimonial[]

  conversationParticipants ConversationParticipant[]

}

model BrandGallery {
  id        String   @id @default(uuid())
  brandId   String

  type      MediaType
  url       String
  width     Int?
  height    Int?
  sizeInMB  Float?
  order     Int      @default(0)

  createdAt DateTime @default(now())

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)

  @@index([brandId])
}

model Quicksite {
  id        String   @id @default(uuid())
  brandId   String   @unique

  title       String?
  about       String?
  address     String?
  city        String?
  state       String?
  country     String?
  pincode     String?

  phone       String?
  email       String?
  website     String?

  instagram   String?
  facebook    String?
  twitter     String?

  latitude    Float?
  longitude   Float?

  seoTitle       String?
  seoDescription String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)
}

model BrandReview {
  id        String   @id @default(uuid())
  brandId   String
  userId    String

  rating    Int
  comment   String?
  testimonial Testimonial?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([brandId, userId]) // one review per user per brand
  @@index([brandId])
  @@index([userId])
}

model Testimonial {
  id        String   @id @default(uuid())
  brandId   String
  reviewId  String

  title     String?
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  brand  Brand @relation(fields: [brandId], references: [id], onDelete: Cascade)
  review BrandReview @relation(fields: [reviewId], references: [id], onDelete: Cascade)

  @@unique([reviewId])
  @@index([brandId])
}


enum MediaType {
  IMAGE
  VIDEO
}

enum PublishStatus {
  DRAFT
  SCHEDULED
  PUBLISHED
}

enum MarketingObjective {
  AWARENESS
  TRAFFIC
  LEAD_GENERATION
  CONVERSIONS
  GET_DIRECTIONS
  MESSAGING
}


model Post {
  id      String @id @default(uuid())
  brandId String
  brand   Brand  @relation(fields: [brandId], references: [id])

  title       String?
  description String?
  tags        String[] @default([])
  category    String?
  trendingScore Float    @default(0)

  marketingObjective MarketingObjective?

  ctaType   String?
  ctaText   String?

  destinationUrl   String?
  googleMapsUrl    String?
  appleMapsUrl     String?
  prefilledMessage String?

  isHighlighted Boolean @default(false)

  publishStatus PublishStatus @default(DRAFT)
  publishAt     DateTime?
  timezone      String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  media PostMedia[]
  likes Like[]
  comments Comment[]
  savedBy SavedPost[]
  collectionItems CollectionItem[]

  leadForm LeadForm?

  @@index([brandId, createdAt])
}



model PostMedia {
  id     String @id @default(uuid())
  postId String
  post   Post   @relation(fields: [postId], references: [id])

  type     MediaType
  url      String
  width    Int?
  height   Int?
  sizeInMB Float?
  order    Int       @default(0)

  createdAt DateTime @default(now())

  @@index([postId])
}

model SavedPost {
  id        String   @id @default(uuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
  post Post @relation(fields: [postId], references: [id])

  @@unique([userId, postId])
  @@index([userId])
}

model Collection {
  id        String   @id @default(uuid())
  userId    String
  name      String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
  items CollectionItem[]

  @@unique([userId, name])
  @@index([userId])
}

model CollectionItem {
  id           String   @id @default(uuid())
  collectionId String
  postId       String
  createdAt    DateTime @default(now())

  collection Collection @relation(fields: [collectionId], references: [id])
  post       Post       @relation(fields: [postId], references: [id])

  @@unique([collectionId, postId])
}



model LeadForm {
  id        String   @id @default(uuid())
  postId    String   @unique
  title     String?
  intro     String?
  createdAt DateTime @default(now())

  post   Post @relation(fields: [postId], references: [id])
  fields LeadFormField[]
}

enum LeadFieldType {
  SHORT_TEXT
  LONG_TEXT
  EMAIL
  PHONE
  DROPDOWN
  CHECKBOX
  RADIO
}

model LeadFormField {
  id         String @id @default(uuid())
  formId     String

  label      String
  type       LeadFieldType
  isRequired Boolean @default(false)
  options    String[] @default([])
  order      Int

  form LeadForm @relation(fields: [formId], references: [id])

  @@index([formId])
}

model LeadSubmission {
  id        String @id @default(uuid())
  formId    String
  postId    String
  userId    String
  answers   Json
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([postId])
  @@index([userId])
}

model Follow {
  id        String   @id @default(uuid())
  userId    String
  brandId   String
  createdAt DateTime @default(now())

  user  User  @relation(fields: [userId], references: [id])
  brand Brand @relation(fields: [brandId], references: [id])

  @@unique([userId, brandId])
  @@index([userId])
}

model Like {
  id        String   @id @default(uuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
  post Post @relation(fields: [postId], references: [id])

  @@unique([userId, postId])
}

model Comment {
  id        String   @id @default(uuid())
  postId    String
  userId    String
  parentId  String?

  content   String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  parent   Comment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies  Comment[] @relation("CommentReplies")

  @@index([postId])
  @@index([parentId])
}

model Conversation {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  participants ConversationParticipant[]
  messages     Message[]

  @@index([createdAt])
}

model ConversationParticipant {
  id             String @id @default(uuid())
  conversationId String

  userId  String?
  brandId String?

  user  User?  @relation(fields: [userId], references: [id])
  brand Brand? @relation(fields: [brandId], references: [id])

  conversation Conversation @relation(fields: [conversationId], references: [id])

  @@index([userId])
  @@index([brandId])
}


model Message {
  id             String   @id @default(uuid())
  conversationId String

  senderUserId  String?
  senderBrandId String?

  content   String
  createdAt DateTime @default(now())
  isRead    Boolean  @default(false)
  readAt    DateTime?

  conversation Conversation @relation(fields: [conversationId], references: [id])

  @@index([conversationId, createdAt])
}

model Notification {
  id String @id @default(uuid())

  userId  String?
  brandId String?

  type String
  title String
  body String

  entityId String?
  entityType String?

  isRead Boolean @default(false)

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([brandId])
}
